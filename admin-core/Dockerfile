FROM eclipse-temurin:11.0.21_9-jdk-nanoserver

ARG ADMIN_VERSION
ARG API_PORT
ARG DEBUG_PORT
ARG SECURE_API_PORT
ARG JVM_ARGS
ARG MAIN_CLASS_NAME

ENV ADMIN_VERSION_ENV=${ADMIN_VERSION}
ENV JVM_ARGS_ENV=${JVM_ARGS}
ENV MAIN_CLASS_NAME_ENV=${MAIN_CLASS_NAME}

RUN mkdir distr && mkdir work

COPY build/libs/admin-core-${ADMIN_VERSION_ENV}-all.jar ./app/drill-admin-${ADMIN_VERSION_ENV}.jar

EXPOSE ${API_PORT}
EXPOSE ${DEBUG_PORT}
EXPOSE ${SECURE_API_PORT}

CMD java %JVM_ARGS_ENV% -cp /app/drill-admin-%ADMIN_VERSION_ENV%.jar %MAIN_CLASS_NAME_ENV%
